@model Services.ServiceModels.PaginatedList<Services.ServiceModels.ApplicationViewModel>
@using Data.Models
@using Services.ServiceModels
@using System.Text.Json;
@using Humanizer

@{
    ViewData["Title"] = "Application List";
    await Html.RenderPartialAsync("_UpdateStatusModal");

    string search = ViewData["Search"] as string;
    string sortBy = ViewData["SortBy"] as string;
    string filterByProgram = ViewData["ProgramFilter"] as string;
    string filterByWorkSetup = ViewData["WorkSetupFilter"] as string;
    string filterByStatus = ViewData["StatusFilter"] as string;


    bool isAdministrative = User.IsInRole("Admin") || User.IsInRole("NLO");
    bool isRecruiter = User.IsInRole("Recruiter");

    string aspAction = "GetAllApplications";

    var programs = ViewBag.Programs as List<Program>;
    var workSetups = ViewBag.WorkSetups as List<SetupType>;
    var statusTypes = ViewBag.AppStatusTypes as List<ApplicationStatusType>;

    int pageIndex = Model.PageIndex;
    bool hasFilters = !string.IsNullOrEmpty(search) ||
        !string.IsNullOrEmpty(filterByProgram) ||
        !string.IsNullOrEmpty(filterByWorkSetup) ||
        !string.IsNullOrEmpty(filterByStatus);

    var sortByCreatedDate = sortBy == "created_asc" ? "created_desc" : "created_asc";
    var sortByTitle = sortBy == "title_asc" ? "title_desc" : "title_asc";
}

<div class="@(User.IsInRole("Applicant") ? "my-20 max-w-7xl max-h-screen min-h-screen mx-auto bg-white rounded-md shadow-md" : "size-full") p-6">
    <div class="flex items-center justify-between">
        <h1 class="pb-8 text-left text-4xl font-bold text-[#7A1515]">
            Job Applications
        </h1>

        <!-- Search Button -->
        <div class="flex items-center space-x-2 pb-8">
            <div class="flex items-center space-x-2">
                @if (hasFilters)
                {
                    <form method="get" asp-action="@aspAction">
                        <button type="submit" class="rounded bg-gray-300 px-2 py-1 text-white">
                            <i class="fa-solid fa-xmark"></i>
                        </button>
                    </form>
                }
                <form method="get" asp-action="@aspAction"
                      class="flex items-center space-x-2">
                    @await Component.InvokeAsync("SearchInput", new { searchValue = search, placeholder = "Applicant, address, job title, company" })
                    <input type="hidden" name="sortBy" value="@sortBy" />
                    <input type="hidden" name="programFilter" value="@filterByProgram" />
                    <input type="hidden" name="workSetupFilter" value="@filterByWorkSetup" />
                    <input type="hidden" name="statusFilter" value="@filterByStatus" />
                </form>
            </div>
        </div>
    </div>

    <!-- Table -->
    <div class="h-[75vh] overflow-auto rounded-lg bg-[#F5F7F8]">
        <div class="flex w-full justify-end bg-white py-2">
            <button onclick="location.href='@Url.Action("", "",
                        new {
                            SortBy = sortBy,
                            Search = search,
                            PageIndex = pageIndex,
                            ProgramFilter = filterByProgram,
                            WorkSetupFilter = filterByWorkSetup,
                            StatusFilter = filterByStatus,
                        })'"
                    class="w-full max-w-[200px] cursor-pointer text-right text-[#343131] hover:text-[#A04747] focus:outline-none">
                <i class="fa fa-archive"></i> Archived Applications
            </button>
        </div>
        <table class="min-w-full table-auto rounded-lg bg-white">
            <thead class="rounded-md bg-gray-100">
                <tr>
                    @if (isAdministrative || isRecruiter)
                    {
                        <!-- Applicant details -->
                        <th class="px-3 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">ID NO.</th>
                        <th class="py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">@Html.DisplayNameFor(model => model.First().Applicant)</th>
                        <th class="px-2 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">
                            <div class="dropdown relative">
                                <a class="cursor-pointer text-[#625f5f] hover:!no-underline hover:text-[#A04747] @(!string.IsNullOrEmpty(filterByProgram) ? "text-[#A04747]" : "")"
                                   href="#" id="statusTypeDropdown" 
                                    data-toggle="dropdown" 
                                    aria-haspopup="true" 
                                    aria-expanded="false">
                                    @if (string.IsNullOrEmpty(filterByProgram))
                                    {
                                        @Html.DisplayNameFor(model => model.First().Applicant.EducationalDetail.Program)
                                    }
                                    else
                                    {
                                        <text>@filterByProgram</text>
                                    }
                                    <i class="fa-solid fa-chevron-down"></i>
                                </a>
                                <div class="dropdown-menu absolute hidden max-h-[200px] space-y-2 overflow-y-auto pt-1 text-[#625f5f]" aria-labelledby="statusTypeDropdown">
                                    <a class="dropdown-item block px-4 text-sm hover:bg-gray-100"
                                       asp-action="@aspAction"
                                       asp-route-sortBy="@sortBy"
                                       asp-route-search="@search"
                                       asp-route-programFilter=""
                                       asp-route-workSetupFilter="@filterByWorkSetup"
                                       asp-route-statusFilter="@filterByStatus">All</a>
                                    @if (programs != null)
                                    {
                                        foreach (var group in programs.OrderBy(pg => pg.Department.Name).GroupBy(pg => pg.Department.Name))
                                        {
                                            <div class="space-y-2">
                                                <span class="block px-4 pt-2 text-sm font-semibold uppercase tracking-wide text-gray-600">
                                                    @group.Key
                                                </span>
                                                @foreach (var p in group)
                                                {
                                                    <a class="dropdown-item block px-4 text-xs hover:bg-gray-100"
                                                       asp-action="@aspAction"
                                                       asp-route-sortBy="@sortBy"
                                                       asp-route-search="@search"
                                                       asp-route-programFilter="@p.ProgramId"
                                                       asp-route-workSetupFilter="@filterByWorkSetup"
                                                       asp-route-statusFilter="@filterByStatus">
                                                        @p.Name
                                                    </a>
                                                }
                                            </div>
                                        }
                                    }
                                </div>
                            </div>
                        </th>

                        <!-- Job title/Position | SORT -->
                        <th class="py-3 pl-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">
                            <a asp-action="@aspAction"
                               asp-route-sortBy="@sortByTitle"
                               asp-route-search="@search"
                               asp-route-programFilter="@filterByProgram"
                               asp-route-workSetupFilter="@filterByWorkSetup"
                               asp-route-statusFilter="@filterByStatus"
                               class="text-[#625f5f] hover:!no-underline hover:text-[#A04747] @(sortBy == "title_asc" || sortBy == "title_desc"? "text-[#A04747]" : "")">
                                Position
                                @(sortBy == "title_asc" ? Html.Raw("<i class='fa-solid fa-sort-up'></i>") : (sortBy == "title_desc" ? Html.Raw("<i class='fa-solid fa-sort-down'></i>") : Html.Raw("<i class='fa-solid fa-sort'></i>")))
                            </a>
                        </th>
                        if (isAdministrative)
                        {
                            <!-- Company details -->
                            <th class="px-3 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">@Html.DisplayNameFor(model => model.First().Job.Company)</th>
                        }
                        <!-- Job location -->
                        <th class="px-3 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">@Html.DisplayNameFor(model => model.First().Job.Location)</th>
                        <!-- Setup type | FILTER -->
                        <th class="px-3 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">
                            <div class="dropdown relative">
                                <a class="cursor-pointer text-[#625f5f] hover:!no-underline hover:text-[#A04747] @(!string.IsNullOrEmpty(filterByWorkSetup) ? "text-[#A04747]" : "")"
                                   href="#" id="statusTypeDropdown" 
                                    data-toggle="dropdown" 
                                    aria-haspopup="true" 
                                    aria-expanded="false">
                                    @if (string.IsNullOrEmpty(filterByWorkSetup))
                                    {
                                        <text>Setup</text>
                                    }
                                    else
                                    {
                                        <text>@filterByWorkSetup</text>
                                    }
                                    <i class="fa-solid fa-chevron-down"></i>
                                </a>
                                <div class="dropdown-menu absolute hidden max-h-[200px] space-y-2 overflow-y-auto pt-1 text-[#625f5f]" aria-labelledby="statusTypeDropdown">
                                    <a class="dropdown-item block px-4 text-sm hover:bg-gray-100"
                                       asp-action="@aspAction"
                                       asp-route-sortBy="@sortBy"
                                       asp-route-search="@search"
                                       asp-route-programFilter="@filterByProgram"
                                       asp-route-workSetupFilter=""
                                       asp-route-statusFilter="@filterByStatus">All</a>
                                    @if (workSetups != null)
                                    {
                                        foreach (var ws in workSetups)
                                        {
                                            <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                                               asp-action="@aspAction"
                                               asp-route-sortBy="@sortBy"
                                               asp-route-search="@search"
                                               asp-route-programFilter="@filterByProgram"
                                               asp-route-workSetupFilter="@ws.SetupTypeId"
                                               asp-route-statusFilter="@filterByStatus">@ws.Name</a>
                                        }
                                    }
                                </div>
                            </div>
                        </th>

                        <!-- Application date | SORT -->
                        <th class="py-3 pl-2 text-xs font-medium uppercase tracking-wider text-[#625f5f]">
                            <a asp-action="@aspAction"
                               asp-route-sortBy="@sortByCreatedDate"
                               asp-route-search="@search"
                               asp-route-programFilter="@filterByProgram"
                               asp-route-workSetupFilter="@filterByWorkSetup"
                               asp-route-statusFilter="@filterByStatus"
                               class="text-[#625f5f] hover:!no-underline hover:text-[#A04747] @(sortBy == "created_asc" || sortBy == "created_desc"? "text-[#A04747]" : "")">
                                @Html.DisplayNameFor(model => model.First().CreatedDate)
                                @(sortBy == "created_asc" ? Html.Raw("<i class='fa-solid fa-sort-up'></i>") : (sortBy == "created_desc" ? Html.Raw("<i class='fa-solid fa-sort-down'></i>") : Html.Raw("<i class='fa-solid fa-sort'></i>")))
                            </a>
                        </th>

                        if (isRecruiter)
                        {
                            <!-- Applicant Resume -->
                            <th class="py-3 pl-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">@Html.DisplayNameFor(model => model.First().Applicant.Resume)</th>
                        }
                        <!-- Application Status | FILTER -->
                        <th class="px-3 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">
                            <div class="dropdown relative">
                                <a class="cursor-pointer text-[#625f5f] hover:!no-underline hover:text-[#A04747] @(!string.IsNullOrEmpty(filterByStatus) ? "text-[#A04747]" : "")"
                                   href="#" id="statusTypeDropdown" 
                                    data-toggle="dropdown" 
                                    aria-haspopup="true" 
                                    aria-expanded="false">
                                    @if (string.IsNullOrEmpty(filterByStatus))
                                    {
                                        <text>Status</text>
                                    }
                                    else
                                    {
                                        <text>@filterByStatus</text>
                                    }
                                    <i class="fa-solid fa-chevron-down"></i>
                                </a>
                                <div class="dropdown-menu absolute hidden max-h-[200px] space-y-2 overflow-y-auto pt-1 text-[#625f5f]" aria-labelledby="statusTypeDropdown">
                                    <a class="dropdown-item block px-4 text-sm hover:bg-gray-100"
                                       asp-action="@aspAction"
                                       asp-route-sortBy="@sortBy"
                                       asp-route-search="@search"
                                       asp-route-programFilter="@filterByProgram"
                                       asp-route-workSetupFilter="@filterByWorkSetup"
                                       asp-route-statusFilter="">All</a>
                                    @if (statusTypes != null)
                                    {
                                        foreach (var st in statusTypes)
                                        {
                                            <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                                               asp-action="@aspAction"
                                               asp-route-sortBy="@sortBy"
                                               asp-route-search="@search"
                                               asp-route-programFilter="@filterByProgram"
                                               asp-route-workSetupFilter="@filterByWorkSetup"
                                               asp-route-statusFilter="@st.ApplicationStatusTypeId">@st.Name</a>
                                        }
                                    }
                                </div>
                            </div>
                        </th>
                    }
                    else
                    {
                        <!-- Job title | SORT -->
                        <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">
                            <a asp-action="@aspAction"
                               asp-route-sortBy="@sortByTitle"
                               asp-route-search="@search"
                               asp-route-programFilter="@filterByProgram"
                               asp-route-workSetupFilter="@filterByWorkSetup"
                               asp-route-statusFilter="@filterByStatus"
                               class="text-[#625f5f] hover:!no-underline hover:text-[#A04747] @(sortBy == "title_asc" || sortBy == "title_desc"? "text-[#A04747]" : "")">
                                POSITION
                                @(sortBy == "title_asc" ? Html.Raw("<i class='fa-solid fa-sort-up'></i>") : (sortBy == "title_desc" ? Html.Raw("<i class='fa-solid fa-sort-down'></i>") : Html.Raw("<i class='fa-solid fa-sort'></i>")))
                            </a>
                        </th>
                        <!-- Company details -->
                        <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">@Html.DisplayNameFor(model => model.First().Job.Company)</th>
                        <!-- Job location -->
                        <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">@Html.DisplayNameFor(model => model.First().Job.Location)</th>
                        <!-- Setup type | FILTER -->
                        <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">
                            <div class="dropdown relative">
                                <a class="cursor-pointer text-[#625f5f] hover:!no-underline hover:text-[#A04747] @(!string.IsNullOrEmpty(filterByWorkSetup) ? "text-[#A04747]" : "")"
                                   href="#" id="statusTypeDropdown" 
                                    data-toggle="dropdown" 
                                    aria-haspopup="true" 
                                    aria-expanded="false">
                                    @if (string.IsNullOrEmpty(filterByWorkSetup))
                                    {
                                        <text>Work Setup</text>
                                    }
                                    else
                                    {
                                        <text>@filterByWorkSetup</text>
                                    }
                                    <i class="fa-solid fa-chevron-down"></i>
                                </a>
                                <div class="dropdown-menu absolute hidden max-h-[200px] space-y-2 overflow-y-auto pt-1 text-[#625f5f]" aria-labelledby="statusTypeDropdown">
                                    <a class="dropdown-item block px-4 text-sm hover:bg-gray-100"
                                       asp-action="@aspAction"
                                       asp-route-sortBy="@sortBy"
                                       asp-route-search="@search"
                                       asp-route-programFilter="@filterByProgram"
                                       asp-route-workSetupFilter=""
                                       asp-route-statusFilter="@filterByStatus">All</a>
                                    @if (workSetups != null)
                                    {
                                        foreach (var ws in workSetups)
                                        {
                                            <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                                               asp-action="@aspAction"
                                               asp-route-sortBy="@sortBy"
                                               asp-route-search="@search"
                                               asp-route-programFilter="@filterByProgram"
                                               asp-route-workSetupFilter="@ws.SetupTypeId"
                                               asp-route-statusFilter="@filterByStatus">@ws.Name</a>
                                        }
                                    }
                                </div>
                            </div>
                        </th>
                        <!-- Application date | SORT -->
                        <th class="px-3 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">
                            <a asp-action="@aspAction"
                               asp-route-sortBy="@sortByCreatedDate"
                               asp-route-search="@search"
                               asp-route-programFilter="@filterByProgram"
                               asp-route-workSetupFilter="@filterByWorkSetup"
                               asp-route-statusFilter="@filterByStatus"
                               class="text-[#625f5f] hover:!no-underline hover:text-[#A04747] @(sortBy == "created_asc" || sortBy == "created_desc"? "text-[#A04747]" : "")">
                                @Html.DisplayNameFor(model => model.First().CreatedDate)
                                @(sortBy == "created_asc" ? Html.Raw("<i class='fa-solid fa-sort-up'></i>") : (sortBy == "created_desc" ? Html.Raw("<i class='fa-solid fa-sort-down'></i>") : Html.Raw("<i class='fa-solid fa-sort'></i>")))
                            </a>
                        </th>
                        <!-- Application Status | FILTER -->
                        <th class="py-3 pl-6 text-xs font-medium uppercase tracking-wider text-[#625f5f]">
                            <div class="dropdown relative">
                                <a class="cursor-pointer text-[#625f5f] hover:!no-underline hover:text-[#A04747] @(!string.IsNullOrEmpty(filterByStatus) ? "text-[#A04747]" : "")"
                                   href="#" id="statusTypeDropdown" 
                                    data-toggle="dropdown" 
                                    aria-haspopup="true" 
                                    aria-expanded="false">
                                    @if (string.IsNullOrEmpty(filterByStatus))
                                    {
                                        <text>Status</text>
                                    }
                                    else
                                    {
                                        <text>@filterByStatus</text>
                                    }
                                    <i class="fa-solid fa-chevron-down"></i>
                                </a>
                                <div class="dropdown-menu absolute hidden max-h-[200px] space-y-2 overflow-y-auto pt-1 text-[#625f5f]" aria-labelledby="statusTypeDropdown">
                                    <a class="dropdown-item block px-4 text-sm hover:bg-gray-100"
                                       asp-action="@aspAction"
                                       asp-route-sortBy="@sortBy"
                                       asp-route-search="@search"
                                       asp-route-programFilter="@filterByProgram"
                                       asp-route-workSetupFilter="@filterByWorkSetup"
                                       asp-route-statusFilter="">All</a>
                                    @if (statusTypes != null)
                                    {
                                        foreach (var st in statusTypes)
                                        {
                                            <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                                               asp-action="@aspAction"
                                               asp-route-sortBy="@sortBy"
                                               asp-route-search="@search"
                                               asp-route-programFilter="@filterByProgram"
                                               asp-route-workSetupFilter="@filterByWorkSetup"
                                               asp-route-statusFilter="@st.ApplicationStatusTypeId">@st.Name</a>
                                        }
                                    }
                                </div>
                            </div>
                        </th>
                        <!-- Recruiter details -->
                        <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">@Html.DisplayNameFor(model => model.First().Job.PostedBy)</th>
                    }
                    <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-[#625f5f]">Action</th>
                </tr>
            </thead>

            <!-- Table Body/Rows -->
            <tbody class="divide-y divide-gray-200 bg-white">
                @if (!Model.Any())
                {
                    <tr>
                        <td colspan="10" class="whitespace-nowrap px-6 py-3 text-center text-sm text-[#625f5f]">
                            @(hasFilters ? "No jobs found" : "No jobs found matching the criteria")
                        </td>
                    </tr>
                }
                else
                {
                    @foreach (var item in Model)
                    {
                        var applicant = item.Applicant;
                        var applicantUser = applicant.User;
                        var applicantResume = applicant.Resume;
                        var applicantEducation = applicant.EducationalDetail;
                        var applicantDetails = $"{item.ApplicantName}\n{applicantEducation.IdNumber}\n{applicantUser.Email}";
                        var applicantProgram = applicantEducation.Program;
                        var company = item.Job.Company;
                        var companyDetails = $"{company.Name}\n{company.ContactEmail}\n{company.ContactNumber}";
                        var job = item.Job;
                        var jobSetup = job.SetupType;
                        var applicationStatus = item.ApplicationStatusType;
                        var applicationDate = $"{item.CreatedDate.ToString("MM/dd/yyyy")} {item.CreatedDate.ToString("hh:mm tt")}";

                        <tr class="hover:bg-gray-100">
                            @if (isAdministrative || isRecruiter)
                            {
                                <td class="w-24 py-3 pl-3 text-sm text-gray-700">
                                    <div class="text-xs font-medium text-[#7A1515]">@applicantEducation.IdNumber</div>
                                </td>

                                <!-- Applicant details | FILTER -->
                                <td class="w-24 py-3 pr-3 text-sm text-gray-700">
                                    <div>
                                        <a href="@Url.Action("GetApplication", "Application",
                                                           new {
                                                                 id = item.ApplicationId,
                                                                  sortBy = sortBy,
                                                                  search = search,
                                                                  pageIndex = Model.PageIndex,
                                                                  filterByWorkSetup = filterByWorkSetup,
                                                                  filterByProgram = filterByProgram,
                                                                  filterByStatus = filterByStatus
                                                                })"
                                           class="text-sm font-semibold text-[#7A1515] hover:underline hover:text-[#A53D3D]">
                                            @item.ApplicantName
                                        </a>
                                        <div class="text-xs">@applicantUser.Email</div>
                                        <div class="text-xs">@applicant.Address</div>
                                    </div>
                                </td>

                                <!-- Applicant's program | FILTER -->
                                <td class="cursor-pointer px-2 py-3 text-xs text-gray-700" title="@applicantProgram.Name">
                                    @applicantProgram.ProgramId
                                </td>
                                <!-- Job title | FILTER -->
                                <td class="px-3 py-3 text-xs text-gray-700">@item.Job.Title</td>
                                if (isAdministrative)
                                {
                                    <!-- Company details | FILTER -->
                                    <td class="px-6 py-3 text-xs text-gray-700">@Html.Raw(companyDetails.Replace("\n", "<br>"))</td>
                                }
                                <!-- Job location | FILTER -->
                                <td class="px-3 py-3 text-xs text-gray-700">@job.Location</td>
                                <!-- Setup type | FILTER -->
                                <td class="px-3 py-3 text-xs text-gray-700">@jobSetup.Name</td>
                                <!-- Application date | SORT -->
                                <td class="w-30 py-3 pl-2 text-xs text-gray-700">@Html.Raw(applicationDate.Replace("\n", "<br>"))</td>
                                if (isRecruiter)
                                {
                                    <!-- Applicant Resume | SORT -->
                                    <td class="w-24 py-3 pl-3 text-xs font-semibold"><a href="# text-[#7A1515] hover:underline hover:text-[#A53D3D]">View Resume</a></td>
                                }
                                <!-- Application Status | FILTER -->
                                <td class="px-3 py-3 text-xs text-gray-700">@item.ApplicationStatusType.Name</td>
                            }
                            else
                            {
                                var recruiter = item.Job.PostedBy;
                                var recruiterDetails = $"{item.RecruiterName}\n{recruiter.User.Email}\n{recruiter.Title}";

                                <!-- Job title | FILTER -->
                                <td class="px-6 py-3 text-sm text-gray-700">
                                    <div>
                                        <a href="@Url.Action("GetApplication", "Application",
                                                   new {
                                                        id = item.ApplicationId,
                                                        sortBy = sortBy,
                                                        search = search,
                                                        pageIndex = Model.PageIndex,
                                                        filterByWorkSetup = filterByWorkSetup,
                                                        filterByProgram = filterByProgram,
                                                        filterByStatus = filterByStatus
                                                        })"
                                           class="text-sm font-semibold text-[#7A1515] hover:underline hover:text-[#A53D3D]">
                                            @item.Job.Title
                                        </a>
                                    </div>
                                </td>
                                <!-- Company details | FILTER -->
                                <td class="px-6 py-3 text-sm font-semibold text-[#7A1515]">
                                    @company.Name
                                    <div class="text-xs font-medium text-gray-700">@company.ContactEmail</div>
                                    <div class="text-xs font-medium text-gray-700">@company.ContactNumber</div>
                                </td>
                                <!-- Job location | FILTER -->
                                <td class="px-6 py-3 text-sm text-gray-700">@job.Location</td>
                                <!-- Setup type | FILTER -->
                                <td class="px-6 py-3 text-sm text-gray-700">@jobSetup.Name</td>
                                <!-- Application date | SORT -->
                                <td class="px-3 py-3 text-sm text-gray-700">@Html.Raw(applicationDate.Replace("\n", "<br>"))</td>
                                <!-- Application Status | FILTER -->
                                <td class="px-6 py-3 text-sm text-gray-700">@item.ApplicationStatusType.Name</td>
                                <!-- Recruiter details -->
                                <td class="px-6 py-3 text-sm font-semibold text-[#7A1515]">
                                    @item.RecruiterName
                                    <div class="text-xs font-medium text-gray-700">@recruiter.User.Email</div>
                                    <div class="text-xs font-medium text-gray-700">@recruiter.Title</div>
                                </td>
                            }

                            <td class="py-3 pl-6 text-left">
                                <!--Action Button DropDown-->
                                <div class="relative">
                                    <button data-applicationid="@item.ApplicationId"
                                            class="actionDropdownApplicationBtn cursor-pointer px-6 text-black hover:text-[#A53D3D] focus:outline-none">
                                        <i class="fas fa-ellipsis-v"></i>
                                    </button>

                                    <div id="actionDropdownApplicationMenu-@item.ApplicationId"
                                         class="actionDropdownApplicationMenu z-10 ring-1 ring-opacity-5 absolute right-0 mt-2 hidden w-48 origin-top-right rounded-md bg-white text-left shadow-lg ring-black">
                                        <div class="space-y-1 py-1">

                                            <!-- Application Details -->
                                            <button onclick="location.href='@Url.Action("GetApplication", "Application",
                                                                new {
                                                                    id = item.ApplicationId,
                                                                    sortBy = sortBy,
                                                                    search = search,
                                                                    pageIndex = Model.PageIndex,
                                                                    filterByWorkSetup = filterByWorkSetup,
                                                                    filterByProgram = filterByProgram,
                                                                    filterByStatus = filterByStatus,
                                                                })'"
                                                    class="text-grey-700 w-full cursor-pointer px-4 py-2 text-left text-sm hover:text-[#A53D3D] focus:outline-none">
                                                <i class="fas fa-info-circle mr-2"></i> Details
                                            </button>

                                                    <button class="update-job-status text-grey-700 w-full cursor-pointer px-4 py-2 text-left text-sm hover:text-[#A53D3D] focus:outline-none disabled:cursor-not-allowed disabled:text-gray-400"
                                                            data-applicationid="@item.ApplicationId"
                                                            data-statusid="@item.ApplicationStatusTypeId"
                                                            data-toggle="modal"
                                                            data-target="#updateApplicationStatusModal">
                                                        <i class="fa-solid fa-rotate mr-2"></i>Update Status
                                                    </button>

                                            <!-- Archive Job -->
                                            <button onclick=" displayDeleteModal('@item.ApplicationId' , '@item.Job.Title')"
                                                    class="text-grey-700 w-full cursor-pointer px-4 py-2 text-left text-sm hover:text-[#A53D3D] focus:outline-none">
                                                <i class="fas fa-archive mr-2"></i> Archive
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </tr>
                    }
                }
            </tbody>
        </table>
    </div>
    <!-- Pagination -->
    <nav class="flex justify-center pt-3">
        <ul class="pagination flex items-center">
            @if (Model.HasPreviousPage)
            {
                <li class="page-item">
                    <a class="page-link border border-red-300 px-3 py-1 text-gray-700 hover:bg-gray-200"
                       asp-action="@aspAction"
                       asp-route-pageIndex="@(Model.PageIndex - 1)"
                       asp-route-search="@search">
                        <i class="fas fa-chevron-left"></i>
                    </a>
                </li>
            }
            @for (int i = 1; i <= Model.TotalPages; i++)
            {
                <li class="page-item @(i == Model.PageIndex ? "active" : "")">
                    <a class="page-link border px-3 py-1 @(i == Model.PageIndex ? "bg-blue-500 text-white" : "text-gray-700 hover:bg-gray-200")"
                       asp-action="@aspAction"
                       asp-route-pageIndex="@i"
                       asp-route-search="@search">
                        @i
                    </a>
                </li>
            }
            @if (Model.HasNextPage)
            {
                <li class="page-item">
                    <a class="page-link border border-red-300 px-3 py-1 text-gray-700 hover:bg-gray-200"
                       asp-action="@aspAction"
                       asp-route-pageIndex="@(Model.PageIndex + 1)"
                       asp-route-search="@search">
                        <i class="fas fa-chevron-right"></i>
                    </a>
                </li>
            }
        </ul>
    </nav>
</div>

@section Scripts {
    <script src="~/js/toastrNotification.js"></script>
    <script src="~/js/application.js"></script>
    <script>
        document.addEventListener('click', function (e) {
            const actionBtn = e.target.closest('.actionDropdownApplicationBtn');
            if (actionBtn) {
                const ApplicationId = actionBtn.dataset.applicationid;
                const menu = document.getElementById(`actionDropdownApplicationMenu-${ApplicationId}`);
                menu.classList.toggle('hidden');

                document.querySelectorAll('.actionDropdownApplicationMenu').forEach(m => {
                    if (m.id !== `actionDropdownApplicationMenu-${ApplicationId}`) {
                        m.classList.add('hidden');
                    }
                });
                return;
            }

            if (!e.target.closest('.actionDropdownApplicationMenu') && !e.target.closest('.actionDropdownApplicationBtn')) {
                document.querySelectorAll('.actionDropdownApplicationMenu').forEach(menu => {
                    menu.classList.add('hidden');
                });
            }
        });
    </script>
}