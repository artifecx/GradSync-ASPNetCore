@using Microsoft.AspNetCore.Http
@inject IHttpContextAccessor HttpContextAccessor

@{
    bool isAdmin = User.IsInRole("Admin");
    bool isSuper = User.HasClaim("IsSuperAdmin", "true");
    bool isRecruiter = User.IsInRole("Recruiter");
    var userId = HttpContextAccessor.HttpContext.User.FindFirst(System.Security.Claims.ClaimTypes.NameIdentifier)?.Value;
    bool hasUnreadNotifications = false;
    int notificationCount = 0;
    var role = HttpContextAccessor.HttpContext.User.FindFirst(System.Security.Claims.ClaimTypes.Role)?.Value;
}

<div class="@((ViewBag.LoginView == true || ViewBag.create == true) ? "hide-navbar" : "sidebar")">
    <div class="cursor-pointer">
        <img src="~/img/logo1.png"
             class="w-48"
             alt="logo"
             onclick="window.location.href = '@(User.IsInRole("Employee") ? Url.Action("GetAll", "Ticket") : Url.Action("Index", "Home"))';">
    </div>
    <div class="mt-5 mb-2 text-gray-700 font-semibold">Navigation</div>
    <ul class="list-none flex-grow">
        @if (isSuper || isAdmin)
        {
            <li class="py-2">
                <a asp-action="Index" asp-controller="Home" class="flex items-center px-2 py-1 rounded hover:bg-gray-200 @(ViewContext.RouteData.Values["Controller"].ToString() == "Home" ? "bg-gray-200" : "")">
                    <i class="fa fa-area-chart mr-2"></i>
                    Dashboard
                </a>
            </li>
            <li class="py-2">
                <a asp-action="Index" asp-controller="User" class="flex items-center px-2 py-1 rounded hover:bg-gray-200 @(ViewContext.RouteData.Values["Controller"].ToString() == "User" ? "bg-gray-200" : "")">
                    <i class="fa fa-users mr-2"></i>
                    Users
                </a>
            </li>
        }
        @if (isAdmin && !isSuper)
        {
            <li class="py-2">
                <a asp-action="" asp-controller="" class="flex items-center px-2 py-1 rounded hover:bg-gray-200 @(ViewContext.RouteData.Values["Controller"].ToString() == "Company" ? "bg-gray-200" : "")">
                    <i class="fa fa-building mr-2"></i>
                    Companies
                </a>
            </li>
            <li class="py-2">
                <a asp-action="" asp-controller="" class="flex items-center px-2 py-1 rounded hover:bg-gray-200 @(ViewContext.RouteData.Values["Controller"].ToString() == "JobManagement" ? "bg-gray-200" : "")">
                    <i class="fa fa-suitcase mr-2"></i>
                    Jobs
                </a>
            </li>
            <li class="py-2">
                <a asp-action="" asp-controller="" class="flex items-center px-2 py-1 rounded hover:bg-gray-200 @(ViewContext.RouteData.Values["Controller"].ToString() == "Application" ? "bg-gray-200" : "")">
                    <i class="fa fa-check-circle-o mr-2"></i>
                    Applications
                </a>
            </li>
            <li class="py-2">
                <a asp-action="GetAll" asp-controller="Education" class="flex items-center px-2 py-1 rounded hover:bg-gray-200 @(ViewContext.RouteData.Values["Controller"].ToString() == "Education" ? "bg-gray-200" : "")">
                    <i class="fa fa-university mr-2"></i>
                    Education
                </a>
            </li>
            <li class="py-2">
                <a asp-action="" asp-controller="" class="flex items-center px-2 py-1 rounded hover:bg-gray-200 @(ViewContext.RouteData.Values["Controller"].ToString() == "SnIManagement" ? "bg-gray-200" : "")">
                    <i class="fa fa-industry mr-2"></i>
                    Skills & Industry
                </a>
            </li>
        }
        @if (isRecruiter)
        {
            <li class="py-2">
                <a asp-action="" asp-controller="" class="flex items-center px-2 py-1 rounded hover:bg-gray-200 @(ViewContext.RouteData.Values["Controller"].ToString() == "Company" ? "bg-gray-200" : "")">
                    <i class="fa fa-building mr-2"></i>
                    Company
                </a>
            </li>
            <li class="py-2">
                <a asp-action="" asp-controller="" class="flex items-center px-2 py-1 rounded hover:bg-gray-200 @(ViewContext.RouteData.Values["Controller"].ToString() == "JobManagement" ? "bg-gray-200" : "")">
                    <i class="fa fa-suitcase mr-2"></i>
                    Jobs
                </a>
            </li>
            <li class="py-2">
                <a asp-action="" asp-controller="" class="flex items-center px-2 py-1 rounded hover:bg-gray-200 @(ViewContext.RouteData.Values["Controller"].ToString() == "Application" ? "bg-gray-200" : "")">
                    <i class="fa fa-check-circle-o mr-2"></i>
                    Applications
                </a>
            </li>
        }
        <li>
            <hr class="my-2 border-gray-300" />
        </li>
        @if (isRecruiter)
        {
            <li class="py-2">
                <a asp-action="" asp-controller="" class="flex items-center px-2 py-1 rounded hover:bg-gray-200">
                    <i class="fa fa-cog mr-2"></i> Settings
                </a>
            </li>
        }
        <li class="py-2">
            <a href="#" data-toggle="modal" data-target="#logoutModal" class="flex items-center px-2 py-1 rounded hover:bg-gray-200">
                <i class="fa fa-sign-out mr-2"></i>
                Log out
            </a>
        </li>
    </ul>
    <div class="flex items-center p-4 bg-gray-100 rounded mt-4">
        <i class="fa fa-user-circle text-4xl mr-3"></i>
        <div>
            <span>@HttpContextAccessor.HttpContext.User.Identity.Name</span>
            @if (isSuper)
            {
                <div class="text-sm text-gray-500">
                    (Super Admin)
                </div>
            }
            else
            {
                <div class="text-sm text-gray-500">
                    (@role)
                </div>
            }
        </div>
    </div>
</div>

<script>
    document.addEventListener("DOMContentLoaded", function () {
        var links = document.querySelectorAll('.sidebar li a');
        links.forEach(function (link) {
            link.addEventListener('click', function () {
                links.forEach(function (link) {
                    link.classList.remove('bg-gray-200');
                });
                this.classList.add('bg-gray-200');
            });
        });
    });
</script>
