@model Services.ServiceModels.PaginatedList<Services.ServiceModels.JobViewModel>
@using Data.Models

@{
    var companies = ViewBag.Companies as List<Company>;
    var employmentTypes = ViewBag.EmploymentTypes as List<EmploymentType>;
    var statusTypes = ViewBag.StatusTypes as List<StatusType>;
    var workSetups = ViewBag.WorkSetups as List<SetupType>;

    string filterByCompany = ViewData["FilterByCompany"] as string;
    string filterByEmploymentType = ViewData["FilterByEmploymentType"] as string;
    string filterByStatusType = ViewData["FilterByStatusType"] as string;
    string filterByWorkSetup = ViewData["FilterByWorkSetup"] as string;

    string sortBy = ViewData["SortBy"] as string;
    string search = ViewData["Search"] as string;

    var employmentTypeDefault = string.Empty;
    var statusTypeDefault = string.Empty;
    var workSetupDefault = string.Empty;
    var sortByDefault = string.Empty;

    string aspAction = User.IsInRole("Recruiter") ? "GetAllJobsRecruiter" : "GetAllJobsAdmin";

    string sortByCreatedDate = sortBy == "created_asc" ? "created_desc" : "created_asc";
}



<tr>
    <th class="px-6 py-3 text-xs font-medium uppercase tracking-wider text-gray-900">
        @Html.DisplayNameFor(model => model.First().Title)
    </th>

    @if (!User.IsInRole("Recruiter"))
    {   
        <!-- Company Column (with dropdown) -->
        <th class="px-6 py-3 text-sm font-medium uppercase tracking-wider text-gray-900">
            <div class="dropdown relative">
                <a class="cursor-pointer text-black" href="#" id="companyDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    @if (filterByCompany == null)
                    {
                        @Html.DisplayNameFor(model => model.First().Company)
                    }
                    else
                    {
                        <text>@filterByCompany</text>
                    }
                    <i class="fa-solid fa-chevron-down"></i>
                </a>

                <div class="dropdown-menu absolute hidden pt-1 text-gray-700" aria-labelledby="companyDropdown">
                    <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                       asp-action="@aspAction"
                       asp-route-sortBy="@sortBy"
                       asp-route-search="@search"
                       asp-route-filterByCompany=""
                       asp-route-filterByEmploymentType="@filterByEmploymentType"
                       asp-route-filterByStatusType="@filterByStatusType"
                       asp-route-filterByWorkSetup="@filterByWorkSetup">All</a>
                    @if (companies != null)
                    {
                        foreach (var c in companies)
                        {
                            <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100" asp-action="@aspAction" asp-route-sortBy="@sortBy" asp-route-search="@search" asp-route-filterByCompany="@c.Name" asp-route-filterByEmploymentType="@filterByEmploymentType" asp-route-filterByStatusType="@filterByStatusType" asp-route-filterByWorkSetup="@filterByWorkSetup">@c.Name</a>
                        }
                    }
                </div>
            </div>
        </th>
    }
    else
    {
        <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
            @Html.DisplayNameFor(model => model.First().AvailableSlots)
        </th>
    }

    <!-- Employment Type Column (with dropdown) -->
    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
        <div class="dropdown relative">
            <a class="cursor-pointer text-gray-900" href="#" id="employmentTypeDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                @if (string.IsNullOrEmpty(filterByEmploymentType))
                {
                    @Html.DisplayNameFor(model => model.First().EmploymentType)
                }
                else
                {
                    <text>@filterByEmploymentType</text>
                }
                <i class="fa-solid fa-chevron-down"></i>
            </a>
            <div class="dropdown-menu absolute hidden pt-1" aria-labelledby="employmentTypeDropdown">
                <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                   asp-action="@aspAction"
                   asp-route-sortBy="@sortBy"
                   asp-route-search="@search"
                   asp-route-filterByCompany="@filterByCompany"
                   asp-route-filterByEmploymentType=""
                   asp-route-filterByStatusType="@filterByStatusType"
                   asp-route-filterByWorkSetup="@filterByWorkSetup">All</a>
                @if (employmentTypes != null)
                {
                    foreach (var et in employmentTypes)
                    {
                        <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                           asp-action="@aspAction"
                           asp-route-sortBy="@sortBy"
                           asp-route-search="@search"
                           asp-route-filterByCompany="@filterByCompany"
                           asp-route-filterByEmploymentType="@et.Name"
                           asp-route-filterByStatusType="@filterByStatusType"
                           asp-route-filterByWorkSetup="@filterByWorkSetup">@et.Name</a>
                    }
                }
            </div>
        </div>
    </th>

    <!-- Status Type Column (with dropdown) -->
    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
        <div class="dropdown relative">
            <a class="cursor-pointer text-black" href="#" id="statusTypeDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                @if (string.IsNullOrEmpty(filterByStatusType))
                {
                    @Html.DisplayNameFor(model => model.First().StatusType)
                }
                else
                {
                    <text>@filterByStatusType</text>
                }
                <i class="fa-solid fa-chevron-down"></i>
            </a>
            <div class="dropdown-menu absolute hidden pt-1 text-gray-700" aria-labelledby="statusTypeDropdown">
                <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                   asp-action="@aspAction"
                   asp-route-sortBy="@sortBy"
                   asp-route-search="@search"
                   asp-route-filterByCompany="@filterByCompany"
                   asp-route-filterByEmploymentType="@filterByEmploymentType"
                   asp-route-filterByStatusType=""
                   asp-route-filterByWorkSetup="@filterByWorkSetup">All</a>
                @if (statusTypes != null)
                {
                    foreach (var st in statusTypes)
                    {
                        <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                           asp-action="@aspAction"
                           asp-route-sortBy="@sortBy"
                           asp-route-search="@search"
                           asp-route-filterByCompany="@filterByCompany"
                           asp-route-filterByEmploymentType="@filterByEmploymentType"
                           asp-route-filterByStatusType="@st.Name"
                           asp-route-filterByWorkSetup="@filterByWorkSetup">@st.Name</a>
                    }
                }
            </div>
        </div>
    </th>

    <!-- Work Setup Column (with dropdown) -->
    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider text-gray-500">
        <div class="dropdown relative">
            <a class="cursor-pointer text-black" href="#" id="workSetupDropdown" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                @if (string.IsNullOrEmpty(filterByWorkSetup))
                {
                    @Html.DisplayNameFor(model => model.First().SetupType)
                }
                else
                {
                    <text>@filterByWorkSetup</text>
                }
                <i class="fa-solid fa-chevron-down"></i>
            </a>
            <div class="dropdown-menu absolute hidden pt-1 text-gray-700" aria-labelledby="workSetupDropdown">
                <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                   asp-action="@aspAction"
                   asp-route-sortBy="@sortBy"
                   asp-route-search="@search"
                   asp-route-filterByCompany="@filterByCompany"
                   asp-route-filterByEmploymentType="@filterByEmploymentType"
                   asp-route-filterByStatusType="@filterByStatusType"
                   asp-route-filterByWorkSetup="">All</a>
                @if (workSetups != null)
                {
                    foreach (var ws in workSetups)
                    {
                        <a class="dropdown-item block px-4 py-2 text-sm hover:bg-gray-100"
                           asp-action="@aspAction"
                           asp-route-sortBy="@sortBy"
                           asp-route-search="@search"
                           asp-route-filterByCompany="@filterByCompany"
                           asp-route-filterByEmploymentType="@filterByEmploymentType"
                           asp-route-filterByStatusType="@filterByStatusType"
                           asp-route-filterByWorkSetup="@ws.Name">@ws.Name</a>
                    }
                }
            </div>
        </div>
    </th>

    <!-- CreatedDate Column (sortable) -->
    <th class="px-6 py-3 text-left text-xs font-medium uppercase tracking-wider">
        <a asp-action="@aspAction"
           asp-route-sortBy="@sortByCreatedDate"
           asp-route-search="@search"
           asp-route-filterByCompany="@filterByCompany"
           asp-route-filterByEmploymentType="@filterByEmploymentType"
           asp-route-filterByStatusType="@filterByStatusType"
           asp-route-filterByWorkSetup="@filterByWorkSetup"
           class="text-black">
            @Html.DisplayNameFor(model => model.First().CreatedDate)
            @(sortBy == "created_asc" ? Html.Raw("<i class='fa-solid fa-sort-up'></i>") : (sortBy == "created_desc" ? Html.Raw("<i class='fa-solid fa-sort-down'></i>") : Html.Raw("<i class='fa-solid fa-sort'></i>")))
        </a>
    </th>
    <!-- Actiion-->
    <th class="px-6 py-3 text-left text-xs font-medium uppercase">Action</th>
</tr>